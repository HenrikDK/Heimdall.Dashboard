<template id="tooltip">
  <div ref="anchor" :class="padding" @@mouseenter="show" @@mouseleave="hide">
    <slot name="cell"/>
  </div>

  <transition 
    enter-from-class="opacity-0"
    leave-to-class="opacity-0"
    enter-active-class="transition delay-500 duration-100"
    leave-active-class="transition duration-100"
    >
      <div v-if="visible" ref="floating" :style="floatingStyles" role="tooltip" 
           class="items-center rounded-md shadow-lg p-2
        text-black bg-gray-100 z-50
        dark:text-gray-200 dark:bg-zinc-800"
      
      >
        <div class="inline-block">
          <slot name="tooltip"/>
        </div>
      </div>
  </transition>
</template>

<script type="module">
import { offset, flip, shift, arrow } from "@@floating-ui/dom";
import { useFloating, autoUpdate } from "@@floating-ui/vue";
import { ref, computed } from 'vue';

let setup = (props, ctx) =>{
  const anchor = ref(null);
  const floating = ref(null);
  const arrowRef = ref(null);
  const visible = ref(false);
  const offsetAmount = 8;

  let hide = async (e) => {
    visible.value = false;
  }

  let show = async (e) => {
    visible.value = true;
  }
  
  const middleware = ref([
    offset(offsetAmount), 
    flip(), 
    shift()
  ]);
  
  const {x, y, strategy, placement, middlewareData } = useFloating(anchor, floating, 
  { 
        placement: props.placement,
        whileElementsMounted: autoUpdate,
        middleware,
  });
  
  const floatingStyles = computed(() => ({
    position: strategy.value,
    top: `${y.value ?? 0}px`,
    left: `${x.value ?? 0}px`
  }));
  
  return {visible, anchor, floating, show, hide, floatingStyles}
}

components["tooltip"] = { template: "#tooltip",
    props: {
      padding: String,
      placement: {
        type: String,
        default: 'bottom'
      }
    },
    setup
};
</script>
